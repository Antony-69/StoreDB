//Усі продукти що не належать жодному замовленню або мають помилку в транзакції

select product_name from products where order_id = 0;
select products.product_name, transactions.payment_status from products join transactions on transactions.order_id = products.order_id where transactions.payment_status = 0;
select products.product_name from products join transactions on transactions.order_id = products.order_id where transactions.payment_status = 0 union all select products.product_name from products where products.order_id = 0;

select 'select products.product_name from products join transactions on transactions.order_id = products.order_id where transactions.payment_status = 0 union all select products.product_name from products where products.order_id = 0' into outfile 'not_ordered_products.sql';


//Усі стори із неоплаченими замовленнями

select stores.store_name from stores inner join orders on orders.store_code = stores.store_code inner join transactions on orders.order_id = transactions.order_id where transactions.payment_status = 0;

select 'select stores.store_name from stores inner join orders on orders.store_code = stores.store_code inner join transactions on orders.order_id = transactions.order_id where transactions.payment_status = 0' into outfile 'select_stores_with_unpayed_products.sql';


//Три топові замовлення по total / sold / shipping_cost

select * from orders order by shipping_cost desc limit 3;
select * from orders order by total desc limit 3;
select * from products order by sold desc limit 3;

select 'select * from orders order by shipping_cost desc limit 3,
select * from orders order by total desc limit 3,
select * from products order by sold desc limit 3' into outfile 'top_values.sql';


//Вирахувати відсоток податку для кожного замовлення відносно total замовлення

select orders.order_id, (orders.total-orders.shipping_cost)/sum(products.price) as tax from orders join products on orders.order_id = products.order_id group by orders.order_id;

select 'select orders.order_id, (orders.total-orders.shipping_cost)/sum(products.price) as tax from orders join products on orders.order_id = products.order_id group by orders.order_id' into outfile 'tax_percentage.sql';


//*Усіх кастомерів у яких співпадає country із billing_country

select distinct customers.customer_name, customers.country as countries from customers join transactions on customers.country = transactions.billing_country;

select 'select distinct customers.customer_name, customers.country as countries from customers join transactions on customers.country = transactions.billing_country' into outfile 'customers_countries.sql';


//*Вивести кількісну статистичну таблицю про усі дані в таблиці по звʼязках, починаючи зі стора

select count(store_code) as stores_num from stores; 
select count(product_id) as products_num from products; 
select count(customer_id) as customers_num from customers; 
select count(order_id) as orders_num from orders; 
select count(billing_id) as transactions_num from transactions; 
select count(credit_card_id) as cards_num from cards; 

select 'select count(store_code) as stores_num from stores
select count(product_id) as products_num from products
select count(customer_id) as customers_num from customers
select count(order_id) as orders_num from orders
select count(billing_id) as transactions_num from transactions 
select count(credit_card_id) as cards_num from cards' into outfile 'statistics.sql'; 


//**Створити представлення для вираховування який обʼєм / масу займають усі продукти разом складені по height / weight

select sum(width_mm*height_mm*length_mm) as volume, sum(height_mm) as total_height, sum(weight_g) as mass from products;

select 'select sum(width_mm*height_mm*length_mm) as volume, sum(height_mm) as total_height, sum(weight_g) as mass from products' into outfile 'volume_height_mass.sql';


//**Створити функцію автоматичного підрахування total по усіх продуктах для певного замовлення

select orders.order_id, sum(products.price)+sum(products.price)*orders.tax+orders.shipping_cost as total from orders join products on orders.order_id = products.order_id group by orders.order_id;

select 'select orders.order_id, sum(products.price)+sum(products.price)*orders.tax+orders.shipping_cost as total from orders join products on orders.order_id = products.order_id group by orders.order_id' into outfile 'total.sql';
